<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RAG Pipeline API App</title>
  <script>
    // ë””ë²„ê·¸ ë¡œê·¸ë¥¼ localStorageì— ì €ì¥
    function debugLog(msg) {
      const logs = JSON.parse(localStorage.getItem('DEBUG_LOGS') || '[]');
      logs.push(new Date().toLocaleTimeString() + ' - ' + msg);
      if (logs.length > 50) logs.shift(); // ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ ì €ì¥
      localStorage.setItem('DEBUG_LOGS', JSON.stringify(logs));
      console.log(msg);
      updateDebugDisplay();
    }

    // í™”ë©´ì— ë””ë²„ê·¸ ë¡œê·¸ í‘œì‹œ
    function updateDebugDisplay() {
      const debugBox = document.getElementById('debugBox');
      if (!debugBox) return;
      const logs = JSON.parse(localStorage.getItem('DEBUG_LOGS') || '[]');
      debugBox.textContent = logs.join('\n');
      debugBox.scrollTop = debugBox.scrollHeight;
    }

    // ë””ë²„ê·¸ ë¡œê·¸ í™•ì¸
    window.showDebugLogs = function() {
      const logs = JSON.parse(localStorage.getItem('DEBUG_LOGS') || '[]');
      console.log('=== ë””ë²„ê·¸ ë¡œê·¸ ===');
      logs.forEach(log => console.log(log));
    };

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì¸ì¦ ì •ë³´ ì¶”ì¶œ í›„ localStorageì— ì €ì¥
    function initAuthFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const auth = params.get('auth');
      const role = params.get('role');
      
      debugLog('URL íŒŒë¼ë¯¸í„° í™•ì¸: search=' + window.location.search + ', auth=' + auth + ', role=' + role);
      
      if (auth === '1' && (role === 'user' || role === 'admin')) {
        debugLog('âœ“ localStorageì— ì €ì¥: auth=1, role=' + role);
        localStorage.setItem('APP_AUTH', '1');
        localStorage.setItem('USER_ROLE', role);
        // URL íŒŒë¼ë¯¸í„° ì œê±° (ê¹”ë”í•˜ê²Œ)
        window.history.replaceState({}, document.title, window.location.pathname);
        return true;
      } else {
        debugLog('âœ— ìœ íš¨í•˜ì§€ ì•Šì€ íŒŒë¼ë¯¸í„°: auth=' + auth + ', role=' + role);
        return false;
      }
    }

    // localStorageì—ì„œ ì¸ì¦ ì •ë³´ í™•ì¸
    function checkAuthFromStorage() {
      const auth = localStorage.getItem('APP_AUTH') === '1';
      debugLog('localStorage í™•ì¸: APP_AUTH=' + localStorage.getItem('APP_AUTH') + ', USER_ROLE=' + localStorage.getItem('USER_ROLE'));
      return auth;
    }

    // localStorageì—ì„œ role ê°’ ì¶”ì¶œ
    function getUserRole() {
      return localStorage.getItem('USER_ROLE');
    }

    // roleë³„ UI ë Œë”ë§
    function renderByRole(role) {
      const badge = document.getElementById('roleBadge');
      const root = document.documentElement;
      const adminCard = document.getElementById('adminCard');

      if (role === 'user') {
        badge.innerHTML = 'ğŸ‘¤ User Role';
        badge.classList.add('user-role');
        root.style.setProperty('--brand', '#3ca3ff');
        root.style.setProperty('--brand-glow', '#6ec8ff');
        document.body.style.backgroundImage = 'radial-gradient(circle at 30% 20%, #07101a 0%, #02060a 100%)';
        if (adminCard) adminCard.style.display = 'none';
      } else if (role === 'admin') {
        badge.innerHTML = 'ğŸ” Admin Role';
        badge.classList.add('admin-role');
        root.style.setProperty('--brand', '#ff3ca3');
        root.style.setProperty('--brand-glow', '#ff6ec8');
        document.body.style.backgroundImage = 'radial-gradient(circle at 30% 20%, #1a0715 0%, #0a0205 100%)';
        if (adminCard) adminCard.style.display = 'flex';
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸ ë° roleë³„ ë Œë”ë§
    debugLog('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
    initAuthFromUrl();

    window.addEventListener('load', function() {
      debugLog('window load ì´ë²¤íŠ¸ ë°œìƒ');
      
      if (!checkAuthFromStorage()) {
        debugLog('âœ— ì¸ì¦ ì •ë³´ ì—†ìŒ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
        window.location.href = 'http://localhost:8080/login';
        return;
      }

      const role = getUserRole();
      debugLog('í˜„ì¬ role: ' + role);
      
      if (role === 'user' || role === 'admin') {
        renderByRole(role);
      } else {
        debugLog('âœ— ì•Œ ìˆ˜ ì—†ëŠ” role - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
        localStorage.removeItem('APP_AUTH');
        localStorage.removeItem('USER_ROLE');
        window.location.href = 'http://localhost:8080/login';
      }
    });
  </script>
  <style>
    :root{
      --bg:#05080c; --panel:#0b0f15; --line:#1a2635;
      --ink:#e6edf3; --muted:#9fb0c0;
      --brand:#3ca3ff; --brand-glow:#6ec8ff;
    }
    *{box-sizing:border-box;}
    html,body{height:100%;margin:0;padding:0;font-family:ui-sans-serif,system-ui,AppleSDGothicNeo,Segoe UI,Roboto,Helvetica,Arial;}
    body{
      background:radial-gradient(circle at 30% 20%, #07101a 0%, #02060a 100%);
      color:var(--ink);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-align:center;
      transition: background 0.3s ease;
    }

    h1{
      font-size:36px;
      font-weight:700;
      letter-spacing:1px;
      margin-bottom:30px;
      color:var(--brand);
      text-shadow:0 0 16px rgba(108,195,255,0.3);
      transition: color 0.3s ease, text-shadow 0.3s ease;
    }

    .role-badge{
      display:inline-block;
      padding:6px 12px;
      border-radius:20px;
      font-size:12px;
      font-weight:600;
      margin-bottom:20px;
      border:1px solid;
      transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    .role-badge.user-role{
      background:#2d5f4f;
      color:#7dd3c0;
      border-color:#4a9f8f;
    }

    .role-badge.admin-role{
      background:#5f2d4f;
      color:#f07dd3;
      border-color:#9f4a8f;
    }

    .dock{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:40px;
      margin-bottom:60px;
    }

    .card{
      width:260px;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:24px;
      box-shadow:0 8px 24px rgba(0,0,0,0.35);
      transition:transform 0.2s ease, box-shadow 0.3s ease;
      text-decoration:none;
      color:var(--ink);
      min-height:140px;
    }
    .card:hover{
      transform:translateY(-4px);
      box-shadow:0 10px 28px rgba(61,142,255,0.35);
    }
    .card:active{ transform:translateY(0); }

    .card.admin-card {
      display: none;
    }

    .card h2{
      font-size:18px;
      font-weight:700;
      margin-bottom:8px;
      color:var(--brand-glow);
    }

    .card p{
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
    }

    footer{
      position:fixed;
      bottom:20px;
      text-align:center;
      width:100%;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.4px;
      padding:0 10px;
    }

    footer .slogan{
      font-style:italic;
      color:var(--brand-glow);
      font-size:13px;
    }

    /* -------- ë°˜ì‘í˜• íŒ¨ì¹˜ ì˜ì—­ -------- */
    @media (max-width: 900px){
      h1{ font-size:30px; }
      .card{ width:320px; }
    }
    @media (max-width: 720px){
      .dock{ gap:28px; margin-bottom:44px; }
      .card{ width:92%; padding:22px; }
      .card h2{ font-size:17px; }
      .card p{ font-size:14px; line-height:1.6; }
    }
    @media (max-width: 420px){
      body{ padding:18px 10px 72px; }   /* í™”ë©´ í…Œë‘ë¦¬ ì—¬ë°± í™•ë³´ */
      h1{ font-size:26px; margin-bottom:20px; }
      .dock{ gap:20px; }
      .card{ width:100%; padding:20px; border-radius:12px; }
      .card h2{ font-size:16px; }
      .card p{ font-size:13px; }
      footer{ bottom:12px; padding:0 10px; }
    }

    /* iPhone ë…¸ì¹˜ ë“± ì•ˆì „ ì˜ì—­ ê³ ë ¤ */
    @supports(padding:max(env(safe-area-inset-bottom), 0px)){
      body{ padding-bottom:calc(40px + env(safe-area-inset-bottom)); }
      footer{ bottom:calc(12px + env(safe-area-inset-bottom)); }
    }
  </style>
</head>
<body>
  <h1>RAG Pipeline API App</h1>
  <div class="role-badge" id="roleBadge"></div>

  <div class="dock">
    <a href="external_index.html" class="card">
      <h2>Closed-Source LLM Console</h2>
      <p>ì™¸ë¶€ ë²¡í„° ì •ë³´ì™€ ê²°í•©ëœ<br>í´ë¡œì¦ˆë“œ ì†ŒìŠ¤ LLM ê¸°ë°˜ RAG íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
    </a>
    <a href="internal_index.html" class="card">
      <h2>Open-Weight LLM Console</h2>
      <p>ì˜¤í”ˆ ì›¨ì´íŠ¸ LLMì„ í™œìš©í•œ<br>ë‚´ë¶€ ë²¡í„°/DB ê¸°ë°˜ RAG ì‹œìŠ¤í…œì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
    </a>
    <a href="admin_dashboard.html" class="card admin-card" id="adminCard">
      <h2>Admin Dashboard</h2>
      <p>ì‹œìŠ¤í…œ ê´€ë¦¬ììš© ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.<br>ì‚¬ìš©ì ê´€ë¦¬ ë° ì‹œìŠ¤í…œ ì„¤ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
    </a>
  </div>

  <!-- ë””ë²„ê·¸ ë¡œê·¸ ë°•ìŠ¤ (F12 ê°œë°œìë„êµ¬ í•„ìš” ì—†ìŒ) -->
  <div id="debugBox" style="position:fixed; bottom:60px; right:10px; width:350px; height:150px; background:#000; color:#0f0; border:1px solid #0f0; border-radius:5px; padding:10px; font-family:monospace; font-size:11px; overflow-y:auto; z-index:9999; display:block; white-space:pre-wrap; word-break:break-all;"></div>

  <footer>
    <div class="slogan">RAG Sense, Spirit Beyond. The RAG spirit is understood, not spoken.</div>
  </footer>

  <script>
    // í˜ì´ì§€ ë¡œë“œ í›„ ë””ë²„ê·¸ ë¡œê·¸ í‘œì‹œ
    window.addEventListener('load', function() {
      updateDebugDisplay();
    });
  </script>
</body>
<!--
#### ì‹¤ìŠµ ì½”ë“œëŠ” í•™ìŠµ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš© ë°”ëë‹ˆë‹¤. audit@korea.ac.kr ì„ì„±ì—´ Ph.D.
python -m http.server 5174
# â†’ http://localhost:5174/intro_main.html ì ‘ì†
-->
</html>
